processors      4 1 1
variable        rho equal 2700.0e-9
variable        l0 equal 1.0
variable        vol_one equal ${l0}^3
variable        mass_one equal ${vol_one}*${rho}
variable        crad equal 0.5*${l0}
variable        h equal 2.5*${l0}
variable        E equal 10 # Young's modulus
variable        nu equal 0.3 # Poisson ratio
variable        sigy equal 0.1
variable        vel equal 100.0
variable        hg equal 0.0
# ----
variable        c0 equal sqrt(${E}/${rho})
variable        dt equal 0.125*${h}/${c0}
print           "sound speed is ${c0}, CFL timestep is ${dt}"
variable        skin equal ${h} # Verlet list range
variable        contact_stiffness equal 10*${E}

units		si
dimension       3
boundary        f f f
atom_style      tlsph
atom_modify	map array
neighbor        ${skin} bin
neigh_modify    every 5 delay 0 check yes # only build neighbor list if particle has moved half the skin distance
comm_modify     vel yes
newton          off

lattice         sc ${l0}
#create a box of dimensions 50 x 50 x 50 mm^3
region          box block -10 83 -10 40 0 100 units box
create_box      2 box

# create plate to be machined
region          plate block 0 70 0 30 0 10 units box
create_atoms    1 region plate

# create machining tool -- diameter equals plate thickness
region          tool cylinder x 15 10 5 72 82 units box
create_atoms    2 region tool

# create region to hold plate still
region          plateBC1 block 0 1 EDGE EDGE EDGE EDGE units box
region          plateBC2 block EDGE EDGE EDGE EDGE 0 1 units box
region          plateBC union 2 plateBC1 plateBC2
group           plateBC region plateBC

group           plate type 1
group           tool  type 2

set             group all diameter ${h}
set             group all contact_radius ${crad}
set             group all mass ${mass_one}
set             group all volume ${vol_one}
set             group plate mol 1
set             group tool mol 2


velocity        tool set -${vel} 0.0 0.0 sum no units box

pair_style      hybrid/overlay tlsph tlsph/ipc_hertz
#                         strength EOS             c0    E     nu   hg    visc sigy
pair_coeff      1 1 tlsph linearplastic     linear ${c0} ${E} ${nu} ${hg} 0.00  ${sigy} 0.2
pair_coeff      2 2 none
pair_coeff      1 2 tlsph/ipc_hertz ${contact_stiffness}

compute         F all tlsph/defgrad
compute         E all tlsph/strain
compute         P all tlsph/eff_plastic_strain
compute         S all tlsph/stress
compute         nn all tlsph/num_neighs
compute         contact_radius all sph/contact_radius
compute         eint all sph/e
compute         alleint all reduce sum c_eint
variable        etot equal ke+c_alleint

thermo          100
thermo_style    custom step ke pe v_etot c_alleint
thermo_modify   lost ignore

# initial run
run             2
fix             inn all store/state 0 c_nn

balance         1.0 shift xy 20 1.0

# time integration
timestep        ${dt}
fix             integration_fix_plate plate tlsph/integrate 1.5e3 #update xsph
fix             force_fix1 tool setforce 0 0 0
fix             force_fix2 plateBC setforce 0 0 0
fix             integration_fix_tool tool tlsph/integrate 1.5e3 #xsph

variable        nrun equal round((60.0/${vel})/${dt})
print "running for ${nrun} steps"

variable        dumpFreq equal round(${nrun}/100)
dump            dump_id all custom ${dumpFreq} dump.LAMMPS id type x y z &
                c_F[1]  c_F[2] c_F[3] c_F[4] c_F[5] c_F[6] c_F[7] c_F[8] c_F[9] c_F[10] &
                c_E[1] c_E[2] c_E[5] &
                c_S[1] c_S[2] c_S[5] &
                fx fy vx vy c_P c_eint &
                c_contact_radius c_nn mol

dump_modify     dump_id first yes

run             0
run             ${nrun}
#
#
#
