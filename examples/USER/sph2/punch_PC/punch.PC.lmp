# punch a spherical impactor through a Polycarbonate plate
processors      2 2 1
variable        rho equal 2700.0e-9
variable        l0 equal 6.0
variable        vol_one equal 0.25*${l0}*${l0}^2
variable        mass_one equal ${vol_one}*${rho}
variable        crad equal 0.5*${l0}
variable        h equal 2.01*${l0}
variable        E equal 10 # Young's modulus
variable        nu equal 0.3 # Poisson ratio
variable        sigy equal 0.1
variable        vel equal 20.0
variable        hg equal 50 #*${sigy}/${E}
# ----
variable        c0 equal sqrt(${E}/${rho})
variable        dt equal 0.5*0.9*0.25*${l0}/${c0}
print           "sound speed is ${c0}, CFL timestep is ${dt}"
variable        skin equal ${h} # Verlet list range
variable        contact_stiffness equal 0.1*${E}

units		si
dimension       3
boundary        s s s
atom_style      tlsph
neighbor        ${skin} bin
neigh_modify    every 5 delay 0 check yes one 10000 # only build neighbor list if particle has moved half the skin distance
comm_modify     vel yes
newton          off

#lattice         custom 1.0 origin 0.5 0.5 0.5 spacing 1 1 0.2
lattice         custom ${l0} basis 0.5 0.5 0.5 a1 1 0 0 a2 0 1 0 a3 0 0 0.25
#create a box of dimensions  mm^3
region          box block 0 300 0 300 -65 60 units box
create_box      2 box

# create plate 300 x 300 x 3
region          plate block 0 300 0 300 0 3 units box
create_atoms    1 region plate
group           target type 1

# create regions where specimen is clamped
region          clamp block 10 290 10 290 EDGE EDGE side out units box
group           clamp region clamp

# set target properties
set             group target diameter ${h}
set             group target contact_radius ${crad}
set             group target mass ${mass_one}
set             group target volume ${vol_one}
set             group target mol 1000

# create impactor
create_atoms    2 single 150 150 -65 units box
group           impactor type 2

# set impactor properties
set             group impactor diameter ${h}
set             group impactor contact_radius 50.0
set             group impactor mass ${mass_one}
set             group impactor volume ${vol_one}
set             group impactor mol 1
velocity        impactor set 0.0 0.0 100 sum no units box

pair_style      hybrid/overlay tlsph tlsph/ipc_hertz
#                         strength          EOS    c0    E     nu   hg    visc sigy
pair_coeff      1 1 tlsph linear                   linear ${c0} ${E} ${nu} ${hg} 1.00  ${sigy}
pair_coeff      2 2 none
pair_coeff      1 2 tlsph/ipc_hertz ${contact_stiffness}

compute         contact_radius all sph/contact_radius
compute         peatom all pe/atom
compute         p all tlsph/eff_plastic_strain
compute         d all tlsph/damage
compute         eps target tlsph/strain



#balance         1.0 shift xy 20 1.0

# time integration
timestep        ${dt}
variable        maxdist equal 0.005*${l0}
fix             dtfix all dt/reset 5 NULL NULL ${maxdist} units box
fix             force_fix1 clamp setforce 0 0 0
fix             force_fix2 impactor setforce 0 0 0
fix             integration_fix all tlsph/integrate 500 xsph update

variable        nrun equal round((50.0/${vel})/${dt})
print "running for ${nrun} steps"

variable        dumpFreq equal round(${nrun}/300)
dump            dump_id all custom ${dumpFreq} dump.LAMMPS id type x y z c_contact_radius c_p c_peatom c_d c_eps[1] c_eps[2] c_eps[3]

dump_modify     dump_id first yes

thermo          100
thermo_style    custom step ke pe dt
thermo_modify   lost ignore

run             250000

# reverse velocity
#velocity        impactor set 0.0 0.0 -100 sum no units box
#run             5000

#
#
#
