variable        l0 equal 1.0
variable        rho equal 1
variable        E equal 1.0 # Young's modulus
variable        nu equal 0.3 # Poisson ratio
variable        G equal ${E}/(2*(1.0+${nu}))
variable        h equal 3.01*${l0}
variable        vol_one equal ${l0}^2 # volume of one particle
variable        mass_one equal ${vol_one}*${rho} # mass of one particle
variable        c0 equal sqrt(${E}/${rho}) # initial guess for the speed of sound
variable        dt equal 0.125*${h}/${c0} # initial time step size
variable        skin equal 0.5*${l0} # Verlet list range
variable        vel equal 0.001

units		si # si means: a consistent system of units is used. Here: mm / GPa / ms
dimension       2 # this is a 2d plane-strain simulation
boundary        sm sm p # simulation box boundaries
atom_style      smd # 
neighbor        ${skin} bin
neigh_modify    every 10 delay 0 check yes
newton          off
comm_modify     vel yes

# create simulation box and particles
lattice         sq ${l0}
region          box block -10 10 -10 10 -0.01 0.01 units box
create_box      1 box
create_atoms    1 box
set             group all mass ${mass_one}
set             group all volume ${vol_one}
set             group all diameter ${h} # set SPH kernel radius

# create particle groups for applying displacement boundary conditions
region          top block EDGE EDGE 9.0 EDGE  EDGE EDGE units box
region          bot block EDGE EDGE EDGE -9.1 EDGE EDGE units box
group           top region top # top row of particles
group           bot region bot # bottom row of particles

pair_style      tlsph # activate Total-Lagrangian SPH
#                           rh0    E    nu    Q1    Q2   hg    Cp
pair_coeff      1 1 *COMMON ${rho} ${E} ${nu} 0.06  0.0  0 1.0 &
                *LINEAR_STRENGTH &
		*EOS_LINEAR &
                *END

compute         E all smd/tlsph_strain
compute         S all smd/tlsph_stress
compute         nn all smd/tlsph_num_neighs
compute         contact_radius all smd/contact_radius
compute         eint all smd/internal_energy
compute         P all smd/plastic_strain
compute         err all smd/hourglass_error

dump            dump_id all custom 100 dump.LAMMPS id type x y z diameter fx fy fz &
		c_E[1] c_E[2] c_E[3] c_E[4] c_E[5] c_E[6] &
                c_S[1] c_S[2] c_S[3] c_S[4] c_S[5] c_S[6] &
                vx vy vz c_eint proc &
                c_nn mol mass c_P c_err radius
dump_modify     dump_id first yes

fix             dtfix all smd/adjust_dt 5 0.1 # adjust time increment very 5 steps with safety factor 0.1
variable        stress equal (f_botfix[2]-f_topfix[2])/2.0
variable        strain equal (2.0*${vel}*f_dtfix[1])

velocity        top set 0.0  ${vel} 0.0 sum no units box # initialize velocity for top row of particles
velocity        bot set 0.0 -${vel} 0.0 sum no units box
fix             topfix top setforce 0 0 0
fix             botfix bot setforce 0 0 0
fix             integration_fix all smd/integrate_tlsph 1.5e3 -1 update

fix             stress_curve all print 10 "${strain} ${stress}" file stress_strain.dat screen no

thermo 100
thermo_style    custom step dt f_dtfix[1] v_strain

run             1000


