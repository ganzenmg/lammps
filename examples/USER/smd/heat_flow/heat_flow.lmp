# create flow by heating and cooling
variable        l0 equal 0.25 # initial particle lattice spacing
variable        rho equal 1 # mass density ulsph
variable        h equal 2.5*${l0} # SPH kernel diameter
variable        c0 equal 1.0 # speed of sound for ulsph
variable        contact_stiffness equal 2*0.5*${c0}^2*${rho} # contact force amplitude
variable        skin equal ${l0} # Verlet list range
variable        vol_one equal ${l0}^2 # initial particle volume for 2d simulation
variable        cr0 equal ${l0}/2

units		si
dimension       2
boundary        sm sm p
atom_style      smd
comm_style      tiled
neighbor        ${skin} bin
neigh_modify    every 5 delay 0 check yes
comm_modify     vel yes
newton          off
atom_modify     map array

# create simulation box, a container, and a ulsph column
region          box block -5.1 5.1 -5.1 5.1 -0.01 0.01 units box
create_box      2 box

region          out block -4 4 -4 4 EDGE EDGE units box side out
region          gas block -3.9 3.9 0.1 3.9 EDGE EDGE units box
region          left block EDGE 0 EDGE EDGE EDGE EDGE units box
region          right block 0 EDGE EDGE EDGE EDGE EDGE units box

region          top block EDGE EDGE 3 EDGE EDGE EDGE units box
region          bot block EDGE EDGE EDGE -3 EDGE EDGE units box
group           top dynamic all region top every 10
group           bot dynamic all region bot every 10

lattice         sq ${l0}
create_atoms    1 region gas
#create_atoms    2 region out
group           ulsph type 1
group           boundary type 2

# initialize particle properties
set             group all meso_rho ${rho}
set             group all diameter ${h}
set             group all contact_radius ${cr0}
set             group all volume  ${vol_one}
set             group all density ${rho}
set             group all meso_e 1.0e-4

# set pair styles
pair_style      hybrid/overlay ulsph smd/hertz 2.0
pair_coeff      1 1 ulsph *COMMON ${rho} ${c0} 1.0 1 &
		*EOS_PERFECT_GAS 1.4 &
	        *END
pair_coeff      2 2 none
pair_coeff      1 2 smd/hertz ${contact_stiffness}

compute         eint all smd/internal_energy
compute         alleint all reduce sum c_eint
compute         contact_radius all smd/contact_radius
compute         S_ulsph ulsph smd/ulsph_stress
compute         nn ulsph smd/ulsph_num_neighs

variable        etot equal pe+ke+c_alleint # total energy of the system
variable        p_gas atom -(c_S_ulsph[1]+c_S_ulsph[2]+c_S_ulsph[3])/3
fix             dtfix all smd/adjust_dt 0.05 # compute stable time increment
fix             integration_fix_ulsph ulsph smd/integrate_ulsph adjust_radius 1.6 xsph
fix             balance_fix all balance 1000 0.9 rcb # load balancing for MPI
#fix             heat_fix1 ulsph smd/heat 1  2.0e-4 region left
#fix             heat_fix2 ulsph smd/heat 1 -1.0e-4 region right
#fix             force_fix1 top addforce 0.00001 0 0 
#fix             force_fix2 bot addforce -0.00001 0 0 

thermo          1
thermo_style    custom step ke pe v_etot c_alleint f_dtfix dt
thermo_modify   lost ignore
dump            dump_id all custom 1 dump.LAMMPS id type x y &
                fx fy vx vy c_eint c_contact_radius mol &
                mass radius c_nn v_p_gas c_eint
dump_modify     dump_id first yes

run             1000
unfix           force_fix1
unfix           force_fix2
run             90000
#>>========>>========>>========>>========>>========>>========>>========>>========
