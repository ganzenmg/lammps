# create flow by heating and cooling
variable        l0 equal 1.0 # initial particle lattice spacing
variable        rho equal 1.0e-6 # mass density ulsph
variable        h equal 2.5*${l0} # SPH kernel diameter
variable        c0 equal 1.0 # speed of sound for ulsph
variable        contact_stiffness equal 100*0.5*${c0}^2*${rho} # contact force amplitude
variable        skin equal ${l0} # Verlet list range
variable        vol_one equal ${l0}^3 # initial particle volume for 2d simulation
variable        cr0 equal 1.0
variable        dtcfl equal 0.1*${l0}/${c0}

units		si
dimension       3
boundary        f f f
atom_style      smd
comm_style      tiled
neighbor        ${skin} bin
neigh_modify    every 1 delay 0 check yes exclude type 2 2 one 10000
comm_modify     vel yes
newton          off
atom_modify     map array


# create simulation box, a container, and a ulsph column
region          box block -30 30 -30 30 -30 30 units box
create_box      2 box

lattice         sc ${l0}
#region          particles sphere 0 0 3 2 units box
#create_atoms    1 region particles
create_atoms    1 single 0 0 3 units box
group           particles type 1

set             group all volume ${vol_one}
set             group all diameter ${h}
set             group all density ${rho}
set             group all meso_rho ${rho}
set             group all contact_radius ${cr0}
pair_style      hybrid/overlay ulsph  smd/tri_surface 1.0
pair_coeff      1 1 ulsph *COMMON ${rho} ${c0} 1.0 1 &
		*EOS_TAIT 2 &
	        *END
pair_coeff      2 2 none
pair_coeff      1 2 smd/tri_surface ${contact_stiffness} 

velocity        particles set -0.2 -0.2 -0.2 units box

fix             stl_surface_fix all smd/wall_surface plate.stl 2 65535
run             0
group           surface type 2

variable        z equal z[1]

thermo          1
thermo_style    custom step dt ke pe v_z
thermo_modify   lost ignore
dump            dump_stl surface smd/stl 1 dump.*.stl
dump_modify     dump_stl first yes

dump            dump_vtk particles smd/vtk 1 dump.*.vtk
dump_modify     dump_vtk first yes

#change_box      all boundary m m m

balance         0.9 rcb


timestep        0.2
#fix             dtfix all smd/adjust_dt 0.1
fix             integration_fix particles smd/integrate_ulsph 
#fix             gfix particles gravity 9.81e-3 vector 0 1 0
#fix             boundary_fix surface smd/move_tri_surf *ROTATE 0 0 0 0 1 0 1.0e-2
fix             bfix all balance 500 0.9 rcb

run             100



