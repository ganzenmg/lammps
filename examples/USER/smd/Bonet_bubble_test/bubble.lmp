#processors      4 1 1
variable        rho equal 1000
variable        h equal 0.08
variable        K equal 2e7 # bulk modulus
variable        vel equal 10.0
variable        hg equal 0
variable        visc equal 0.1
# ----
variable        c0 equal sqrt(${K}/${rho})
variable        dt equal 0.125*${h}/${c0}
print           "sound speed is ${c0}, CFL timestep is ${dt}"
variable        skin equal 0.5*${h} # Verlet list range

units		si
dimension       2
boundary        s s p
atom_style      smd
comm_style      brick
neighbor        ${skin} bin
neigh_modify    every 10 delay 0 check yes
comm_modify     vel yes
newton          off

read_data       disc_adjusted.data


pair_style      ulsph
pair_coeff      1 1 *COMMON ${rho} ${c0} ${visc} 0 ${hg} &
		*EOS_TAIT 7 &
                *STRENGTH_VISCOSITY_NEWTON 0.5 &
		*GRADIENT_CORRECTION &
	        *END




compute         rho all smd/rho
compute         nn all smd/ulsph_num_neighs
compute         contact_radius all smd/contact_radius
compute         eint all smd/internal_energy
compute         alleint all reduce sum c_eint
compute         S all smd/ulsph_stress
variable        etot equal ke+c_alleint+pe
variable        amx equal angmom(all,x)
variable        amy equal angmom(all,y)
variable        amz equal angmom(all,z)

# time integration
timestep        ${dt}
#fix             dtfix all smd/adjust_dt 0.1
fix             integration_fix all smd/integrate_ulsph #adjust_radius 1.2
#fix             output_fix all print 10 "${disp} ${force} ${strain} ${stress}" file force_displacement.dat screen no

variable        dumpFreq equal 100 #round(${nrun}/1000)
dump            dump_id all custom ${dumpFreq} dump.LAMMPS id type x y z &
                fx fy fz vx vy vz c_eint &
                c_contact_radius c_nn mol c_rho c_S[1] c_S[2] c_S[4] radius

dump_modify     dump_id first yes

thermo          100
thermo_style    custom step ke pe v_etot c_alleint dt v_amz time

velocity        all ramp vx  -0.1 0.1 y -1.0 1.0 units box
velocity        all ramp vy  -0.1 0.1 x  1.0 -1.0 units box
#velocity        all ramp vx    1 -1 x -1.0 1.0 units box
#velocity        all ramp vy    -1 1 y -1.0 1.0 units box

#velocity       all set 0 -1 0 units box
#fix             ywall all wall/reflect ylo -1.0

run 5000

